<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• Infinite Meme Feed 4.2 - Super Engaging!</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212;
            color: white;
            text-align: center;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        #feed {
            max-width: 600px;
            margin: auto;
        }

        .meme {
            position: relative;
            background: #222;
            margin: 20px 0;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.6);
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        .meme:hover {
            transform: scale(1.05);
        }

        .meme img {
            width: 100%;
            border-radius: 10px;
            display: block;
            transition: opacity 0.3s ease-in-out;
        }

        .caption {
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            margin-top: 12px;
            color: #eee;
        }

        .reaction-bar {
            display: flex;
            justify-content: space-around;
            padding: 15px 10px 10px;
            flex-wrap: wrap;
        }

        .reaction-bar button {
            cursor: pointer;
            font-size: 1rem;
            padding: 8px 16px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 20px;
            margin: 5px;
            transition: background-color 0.2s ease;
            flex-grow: 1;
            min-width: 60px;
        }

        .reaction-bar button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2rem;
            opacity: 0.8;
            transition: transform 0.2s ease;
        }

        .overlay:hover {
            transform: scale(1.2);
        }

        .loading {
            display: none;
            margin: 30px auto;
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: #ff6347;
            font-weight: bold;
            margin: 20px;
            display: none;
        }

        .share-button {
            margin-top: 5px;
            font-size: 0.9rem;
            background-color: #1da1f2;
            color: white;
        }

        .reacted {
            animation: pulse 0.3s ease;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Add responsiveness */
        @media (max-width: 600px) {
            .reaction-bar {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Fun Confetti Animation */
        @keyframes confetti {
            0% { transform: rotate(0deg); opacity: 1; }
            100% { transform: rotate(720deg); opacity: 0; }
        }

        .confetti {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 5px;
            height: 5px;
            background: #ff6347;
            opacity: 0;
            animation: confetti 1s ease-in-out infinite;
        }

        .confetti:nth-child(odd) {
            animation-duration: 1.2s;
        }

        .confetti:nth-child(even) {
            animation-duration: 1.4s;
        }

        .confetti--animate {
            animation: confetti 1s ease-in-out infinite;
        }
    </style>
</head>
<body>

    <h1>üî• Infinite Meme Feed 4.2 - Super Engaging!</h1>
    <div id="feed"></div>
    <div class="loading"></div>
    <div class="error-message">Oops! Something went wrong loading memes.</div>

    <script>
      const feed = document.getElementById("feed");
      const loadingIndicator = document.querySelector(".loading");
      const errorMessage = document.querySelector(".error-message");

      let memeTemplates = [];
      let captions = [ /* Array of captions here */];
      let stickers = [ /* Array of stickers here */];
      let userPreferences = {
        likes: [],
        dislikedMemes: []
      };

      async function fetchMemes() {
        loadingIndicator.style.display = "block";
        errorMessage.style.display = "none";

        try {
            const imgflipResponse = await fetch("https://api.imgflip.com/get_memes");
            const imgflipData = await imgflipResponse.json();
            if (imgflipData.success) {
                memeTemplates = memeTemplates.concat(imgflipData.data.memes.map(m => ({ url: m.url })));
            } else {
                throw new Error("Imgflip API error: " + imgflipData.error_message);
            }

            const redditResponse = await fetch("https://www.reddit.com/r/memes/hot.json?limit=25");
            const redditData = await redditResponse.json();
            redditData.data.children.forEach(post => {
                if (post.data.url.endsWith(".jpg") || post.data.url.endsWith(".png")) {
                    memeTemplates.push({ url: post.data.url });
                }
            });

            loadMoreMemes(8);
        } catch (error) {
            console.error("Error fetching memes:", error);
            errorMessage.style.display = "block";
        } finally {
            loadingIndicator.style.display = "none";
        }
      }

      function getRandomItem(arr) {
          return arr[Math.floor(Math.random() * arr.length)];
      }

      function generateMemeImage() {
          if (memeTemplates.length === 0) return;

          let memeTemplate = getRandomItem(memeTemplates);
          const memeDiv = document.createElement("div");
          memeDiv.className = "meme";

          let overlayText = getRandomItem(stickers);
          let captionText = getRandomItem(captions);

          memeDiv.innerHTML = `
              <img src="${memeTemplate.url}" alt="Meme" loading="lazy">
              <div class="overlay">${overlayText}</div>
              <div class="caption">${captionText}</div>
              <div class="reaction-bar">
                  <button onclick="react('${memeTemplate.url}', 'üòÇ')">üòÇ Laugh</button>
                  <button onclick="react('${memeTemplate.url}', 'üî•')">üî• Fire</button>
                  <button onclick="react('${memeTemplate.url}', 'ü§°')">ü§° Clown</button>
                  <button onclick="react('${memeTemplate.url}', 'üíÄ')">üíÄ Dead</button>
                  <button onclick="react('${memeTemplate.url}', 'üëç')">üëç Lit</button>
                  <button onclick="react('${memeTemplate.url}', 'ü§Ø')">ü§Ø Mindblown</button>
                  <button onclick="react('${memeTemplate.url}', 'ü§î')">ü§î Thinking</button>
                  <button class="share-button" onclick="shareMeme('${memeTemplate.url}')">Share</button>
              </div>
          `;
          memeDiv.addEventListener("mouseenter", () => trackEngagement(memeTemplate.url));
          feed.appendChild(memeDiv);
          memeTemplates = memeTemplates.filter(m => m.url != memeTemplate.url)
      }

      function loadMoreMemes(count) {
          for (let i = 0; i < count; i++) {
              generateMemeImage();
          }
      }

      function react(memeUrl, reaction) {
          console.log(`Reaction: ${reaction} on ${memeUrl}`);
          trackEngagement(memeUrl, reaction);
          event.target.classList.add("reacted");
          addConfetti(event.target);
          playReactionSound();
          setTimeout(() => event.target.classList.remove("reacted"), 300);
      }

      function addConfetti(button) {
          for (let i = 0; i < 20; i++) {
              let confetti = document.createElement("div");
              confetti.classList.add("confetti", "confetti--animate");
              button.appendChild(confetti);
              setTimeout(() => confetti.remove(), 1000);
          }
      }

      function playReactionSound() {
          let sound = new Audio('path_to_sound_file.mp3');  // Add a fun reaction sound
          sound.play();
      }

      async function shareMeme(memeUrl) {
          if (navigator.share) {
            try{
                await navigator.share({
                    title: 'Check out this meme!',
                    url: memeUrl
                });
                console.log('Meme shared successfully');
            } catch(err) {
                console.error('Error sharing:', err);
            }
          } else {
              navigator.clipboard.writeText(memeUrl).then(() => {
                alert("Meme URL copied to clipboard!");
              }).catch(err => {
                console.error('Failed to copy meme URL: ', err);
                alert("Could not copy URL.  Please copy it manually.");
              });
          }
      }

      let engagementData = {};

      function trackEngagement(memeUrl, reaction = null) {
          if (!engagementData[memeUrl]) {
              engagementData[memeUrl] = { views: 0, reactions: {} };
          }
          engagementData[memeUrl].views += 1;
          if (reaction) {
              if (!engagementData[memeUrl].reactions[reaction]) {
                  engagementData[memeUrl].reactions[reaction] = 0;
              }
              engagementData[memeUrl].reactions[reaction] += 1;
          }
        console.log("Engagement Data:", engagementData);
      }

      window.addEventListener("scroll", () => {
          if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
              loadMoreMemes(5);
          }
      });

      fetchMemes();
    </script>

</body>
</html>
